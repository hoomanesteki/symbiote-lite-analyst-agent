version: '3.8'

services:
  # Interactive CLI Agent
  agent:
    build: .
    container_name: symbiote-lite-agent
    stdin_open: true
    tty: true
    volumes:
      - ./data:/app/data
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - SYMBIOTE_DB_PATH=/app/data/taxi_trips.sqlite
    command: python -m scripts.run_agent

  # Gradio Web UI
  gradio-ui:
    build: .
    container_name: symbiote-lite-ui
    ports:
      - "7860:7860"
    volumes:
      - ./data:/app/data
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - SYMBIOTE_DB_PATH=/app/data/taxi_trips.sqlite
    command: python -m scripts.gradio_app

  # MCP Server (for external clients)
  mcp-server:
    build: .
    container_name: symbiote-lite-mcp
    ports:
      - "8000:8000"
    volumes:
      - ./data:/app/data
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - SYMBIOTE_DB_PATH=/app/data/taxi_trips.sqlite
    command: python -m scripts.mcp_server

  # Test runner
  test:
    build: .
    container_name: symbiote-lite-test
    volumes:
      - ./data:/app/data
      - ./tests:/app/tests
    environment:
      - SYMBIOTE_DB_PATH=/app/data/taxi_trips.sqlite
    command: python -m pytest -v
    profiles:
      - test

# Usage:
# ------
# Interactive CLI agent:  docker-compose run agent
# Gradio Web UI:          docker-compose up gradio-ui     → http://localhost:7860
# MCP server:             docker-compose up mcp-server    → http://localhost:8000
# Run tests:              docker-compose --profile test run test
# Build only:             docker-compose build
